angular.module("autoFields",["ui.bootstrap"]).directive("autoFields",["$compile",function(a){return{restrict:"E",priority:1,replace:!0,compile:function(){return function(b,c,d){var e=d.fields||d.autoFields,f=d.options,g=d.data,h=d.form||"autoFields",i=null,j={classes:{formGroup:"form-group",input:"form-control",label:"control-label",col:"col-sm-"},container:'<div class="autoFields" ng-form name="'+h+'"></div>',defaultOption:"Select One",validation:{enabled:!0,showMessages:!0,defaultMsgs:{required:"This field is required",minlength:"This is under minimum length",maxlength:"This exceeds maximum length",min:"This is under the minumum value",max:"This exceeds the maximum value",email:"This is not a valid email address",valid:"This field is valid"}},dateSettings:{showWeeks:!1},textareaRows:3,fixUrl:!0};b.dateSettings=j.dateSettings,null==b.tabIndex&&(b.tabIndex=1);var k=function(a,b){var c='<div class="'+j.classes.formGroup+" "+a.type+'"';switch(j.validation.enabled&&(c+=" ng-class=\"{'has-error':"+A(a)+", 'has-success':"+B(a)+'}"'),c+=">",a.type){case"checkbox":c+=o(a,b);break;case"multiple":c='<div class="'+a.type+'">',c+=n(a,b);break;case"date":c+=m(a),c+=p(a,b);break;case"select":c+=m(a),c+=r(a,b);break;case"textarea":c+=m(a),c+=s(a,b);break;default:c+=m(a),c+=t(a,b)}return c+="</div>"},l=function(a){return a.label||y(a.property)},m=function(a){return'<label class="'+j.classes.label+'" for="'+a.property+'">'+l(a)+"</label>"},n=function(a,b){var c='<div class="row">',d=[],f=angular.copy(e);return e+="["+b+"].fields",angular.forEach(a.fields,function(b,c){var e='<div class="'+j.classes.col+(b.columns||a.columns)+'">';e+=k(b,c),e+="</div>",d.push(e)}),e=f,c+=d.join(" ")+"</div>"},o=function(a,b){var c='<label> <input type="checkbox"'+q(a,b)+v(a,b)+"/> "+l(a)+"</label>";return c},p=function(a,b){return'<input type="text" show-weeks="dateSettings.showWeeks" datepicker-popup="MMMM dd, yyyy"'+q(a,b)+v(a,b)+" />"},q=function(a,c){var d=' id="'+a.property+'" tabindex="'+b.tabIndex+'" name="'+a.property+'" ng-model="'+(a.value?"autoForm"+e.replace(/(\[|\])/g,"_")+c+".model":g+"['"+a.property+"']")+'" placeholder="'+(a.placeholder?a.placeholder:l(a))+'" ';return null!=a.value&&(d+='value-function="'+e+"["+c+'].value"'),"checkbox"!=a.type&&(d+='class="'+j.classes.input+" "+a.type+'" '),j.validation.enabled&&j.validation.showMessages&&(d+=u(a,c)),b.tabIndex++,d},r=function(a,b){var c='<select ng-options="'+a.list+'"';return c+=q(a,b),null!=a.attr&&(c+=v(a,b)),c+=">",c+='<option value="">'+(a.defaultOption?a.defaultOption:j.defaultOption)+"</option>",c+="</select>"},s=function(a,b){var c='<textarea rows="'+(a.rows?a.rows:j.textareaRows)+'"';return c+=q(a,b),null!=a.attr&&(c+=v(a,b)),c+="></textarea>"},t=function(a,b){var c='<input type="'+a.type+'"';return c+=q(a,b),null!=a.attr&&(c+=v(a,b)),"url"!=a.type||1!=a.fixUrl&&1!=j.fixUrl||(c+="fix-url"),c+="></input>"},u=function(a){var c=[];angular.forEach(angular.extend({},j.validation.defaultMsgs,a.msgs),function(b,d){(a.msgs&&null!=a.msgs[d]||a.type==d||a.attr&&(null!=a.attr[d]||null!=a.attr["ng"+y(d)]))&&c.push("("+h+"."+a.property+".$error."+d+"? '"+b+"' : '')")});var d=a.msgs&&a.msgs.valid?a.msgs.valid:j.validation.defaultMsgs.valid;if(c.length)var e=' popover-trigger="focus" popover="{{('+B(a)+")? '"+d+"' : ("+c.join("+")+')}}" popover-placement="top"';return e},v=function(a){var c=[];return angular.forEach(a.attr,function(a,b){var d=z(b)+'="'+a+'"';c.push(d)}),c.join(" ")},w=null,x=function(c){c=c||b[e],i.html(""),angular.forEach(c,function(a,b){i.append(k(a,b))}),null!=w&&w.$destroy(),w=b.$new(),w.data=b[g],w.fields=c,a(i)(w)};b.$watch(f,function(a,b){C(j,a),a!==b&&x()},!0),b.$watch(e,function(a){x(a)},!0),i=angular.element(j.container),c.replaceWith(i);var y=function(a){return a.replace(/([A-Z])/g," $1").replace(/^./,function(a){return a.toUpperCase()})},z=function(a){return a.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()},A=function(a){return h+"."+a.property+".$invalid && "+h+"."+a.property+".$dirty"},B=function(a){return h+"."+a.property+".$valid"},C=function(a){return angular.forEach(arguments,function(b){b!==a&&angular.forEach(b,function(b,c){a[c]&&a[c].constructor&&a[c].constructor===Object?C(a[c],b):a[c]=b})}),a}}}}}]).directive("fixUrl",[function(){return{restrict:"A",require:"ngModel",link:function(a,b,c,d){var e=/^(https?:\/\/)?([\da-z\.-]+)\.([a-z\.]{2,6})([\/\w\.\-\?\=\&]*)$/i,f=function(){var a=d.$modelValue;if(null!=a){for(var b in d.$formatters)a=d.$formatters[b](a);d.$viewValue=a,d.$render()}};b.bind("blur",f);var g=function(a){var b=e.test(a);if(b){var c=a.match(e),d=null!=c[1]&&""!=c[1]?c[1]:"http://";d+=c[2]+"."+c[3],"undefined"!=typeof c[4]&&(d+=c[4]),a=d}return a};d.$formatters.push(g),d.$parsers.unshift(g)}}}]).directive("valueFunction",[function(){return{restrict:"A",require:"ngModel",link:function(a,b,c){var e=a.$eval(c.valueFunction);a.$watch(c.valueFunction+"()",function(b){null!=b&&a.$eval(c.ngModel+"="+c.valueFunction+"()")});var f=function(b){e(a.$eval(c.ngModel)),b!==!0&&a.$apply()};a.$watch(c.ngModel,function(){null!=f&&f(!0)})}}}]);